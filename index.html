<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>JLS BARCODE GENERATION</title>

  <!-- Barcode library -->
  <script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.5/dist/JsBarcode.all.min.js"></script>

  <!-- PWA Manifest -->
  <link rel="manifest" href="manifest.json" />

  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      min-height: 100vh;
      background: #f5f5f5;
      margin: 0;
      padding: 20px;
    }
    h1 { font-size: 26px; margin-bottom: 4px; }
    .hint { color: #666; margin-bottom: 18px; }

    form {
      display: flex;
      flex-direction: column;
      gap: 12px;
      width: 100%;
      max-width: 420px;
    }

    input {
      font-size: 22px;
      padding: 8px 10px;
      border-radius: 6px;
      border: 1px solid #bbb;
    }

    button {
      font-size: 20px;
      padding: 14px;
      border-radius: 8px;
      background: #0066ff;
      border: none;
      color: white;
      cursor: pointer;
      margin-top: 10px;
    }

    .preview-box {
      background: white;
      width: 100%;
      max-width: 420px;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      margin-top: 20px;
      text-align: center;
    }

    .history {
      margin-top: 25px;
      max-width: 420px;
      width: 100%;
    }

    .history-row {
      background: white;
      padding: 10px 14px;
      border-radius: 6px;
      box-shadow: 0 1px 3px rgba(0,0,0,0.1);
      margin-bottom: 8px;
      display: flex;
      justify-content: space-between;
    }
  </style>
</head>

<body>

  <h1>JLS BARCODE GENERATION</h1>
  <div class="hint">Type Code → Enter → Type Qty → Enter to print. Last 3 labels shown below.</div>

  <form id="form">
    <label>Item Code:</label>
    <input id="code" placeholder="e.g. 50000" autofocus />

    <label>Quantity:</label>
    <input id="qty" placeholder="e.g. 4.5" />
  </form>

  <button id="printBtn">Print Label</button>

  <div class="preview-box">
    <svg id="barcode"></svg>
    <div id="labelText"></div>
  </div>

  <div class="history">
    <b>Last 3 printed labels:</b>
    <div id="historyList"></div>
  </div>

  <script>
    const codeInput = document.getElementById("code");
    const qtyInput = document.getElementById("qty");
    const preview = document.getElementById("barcode");
    const previewText = document.getElementById("labelText");
    const historyList = document.getElementById("historyList");

    let history = [];

    function generateLabel() {
      const code = codeInput.value.trim();
      const qty = qtyInput.value.trim();
      if (!code || !qty) return;

      JsBarcode("#barcode", code, { width: 2, height: 80 });
      previewText.innerHTML = `Code: ${code} &nbsp;&nbsp; Qty: ${qty}`;
    }

    // Auto-generate when typing
    codeInput.addEventListener("input", generateLabel);
    qtyInput.addEventListener("input", generateLabel);

    // Handle Enter key printing
    qtyInput.addEventListener("keydown", (e) => {
      if (e.key === "Enter") {
        e.preventDefault();
        printLabel();
      }
    });

    document.getElementById("printBtn").addEventListener("click", printLabel);

    function printLabel() {
      const code = codeInput.value.trim();
      const qty = qtyInput.value.trim();
      if (!code || !qty) return;

      window.print();

      // Save history
      const time = new Date().toLocaleTimeString();
      history.unshift({ code, qty, time });
      history = history.slice(0, 3);

      renderHistory();

      // Reset inputs
      codeInput.value = "";
      qtyInput.value = "";
      preview.innerHTML = "";
      previewText.innerHTML = "";
      codeInput.focus();
    }

    function renderHistory() {
      historyList.innerHTML = history
        .map(h => `<div class="history-row"> Code: ${h.code} &nbsp; Qty: ${h.qty} <span>${h.time}</span></div>`)
        .join("");
    }
  </script>

</body>
</html>
